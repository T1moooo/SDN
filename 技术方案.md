### 技术方案：基于SDN的校园网智能运维与策略管理平台

#### 1. 项目概述

**1.1. 项目目标**
本项目旨在构建一个自动化的网络运维与策略管理平台，以应对校园网中日益复杂的管理需求。平台将基于SDN思想，利用Cisco Nexus 9000v的可编程能力，实现两大核心目标：
1.  **智能故障监控与告警**：主动发现并定位网络问题，提升运维响应速度。
2.  **动态QoS策略管理**：根据应用需求（如保障“选课系统”的优先级），自动化地调整网络资源分配，实现网络即服务（NaaS）。

**1.2. 核心功能 (三周MVP)**
- **基于策略的QoS自动化**：
    - **策略定义**：通过简单的YAML文件定义网络策略，如“将源自选课系统服务器IP的流量标记为高优先级”。
    - **策略下发**：平台自动解析YAML文件，生成对应的NX-API命令，并下发到Nexus交换机以更新QoS配置。
- **基础健康监控**：
    - **状态采集**：周期性通过NX-API获取设备关键指标（CPU、内存、接口状态）。
    - **简易仪表盘**：通过Web界面展示采集到的基本健康信息。

#### 2. 技术架构

系统采用模块化设计，为未来集成Chef/Puppet/NETCONF等工具预留扩展点。

```mermaid
graph TD
    subgraph 定义与交互 (Policy & Interaction)
        A[策略文件 (policy.yaml)]
        B[Web前端/API客户端]
    end

    subgraph 智能运维平台 (Python应用)
        C[Web服务 (Flask API)]
        D[策略引擎 (Policy Engine)]
        E[任务调度器 (APScheduler)]
        F[数据采集模块 (Collector)]
        G[配置下发模块 (Deployer)]
    end

    subgraph 网络设备 (Nexus 9000v)
        H[NX-API REST]
    end

    A --> D
    B --> C
    C --> D
    D --> G
    E --> F
    F --> H
    G --> H
```

- **策略引擎 (Policy Engine)**: 核心模块。负责读取并解析YAML格式的策略文件，将其翻译成一系列具体的设备配置命令（通过NX-API执行）。
- **配置下发模块 (Deployer)**: 接收策略引擎生成的命令，通过HTTPS与NX-API通信，完成配置的下发。它将处理认证、错误处理和回滚逻辑。
- **数据采集模块 (Collector)**: 由任务调度器驱动，定期通过NX-API采集设备状态信息，为监控提供数据源。
- **Web服务 (Flask API)**: 提供RESTful API接口，允许用户手动触发策略更新，并为前端提供监控数据。

#### 3. 技术选型

- **编程语言**: **Python 3.x**
- **设备接口**: **Cisco NX-API (REST)** - 优先选择REST接口，因为它轻量、无客户端依赖，能最快实现功能。
- **策略定义**: **YAML** - 格式清晰，可读性强，非常适合定义“意图”。
- **Web框架**: **Flask** - 快速构建API和简单的Web界面。
- **任务调度**: **APScheduler** - 实现周期性的健康检查任务。
- **HTTP客户端**: **Requests** - 业界标准的Python HTTP库。

#### 4. 三周项目实施计划

**第一周：基础建设与能力探索 (2025/09/29 - 2025/10/05)**
- **目标**: 验证通过NX-API实现QoS配置的可行性，并搭建好项目框架。
- **任务**:
  1.  **环境准备**: 安装Python及`flask`, `requests`, `pyyaml`, `apscheduler`库。
  2.  **Nexus 9000v准备**: 确保NX-API已启用，并准备好一个测试接口。
  3.  **关键API探索 (核心任务)**: 使用Postman或Python脚本，手动调试通过NX-API配置QoS所需的完整命令序列。这可能包括：
      - 创建`class-map`来匹配流量（如基于ACL）。
      - 创建`policy-map`来定义行为（如设置`dscp`值）。 
      - 将`policy-map`应用到接口上。
      - **产出**: 一个可以成功修改接口QoS策略的Python脚本。
  4.  **项目结构搭建**: 创建`app.py`, `collector.py`, `engine.py`等基本文件结构。

**第二周：策略引擎与自动化下发 (2025/10/06 - 2025/10/12)**
- **目标**: 实现从YAML策略文件到设备配置的自动转换和下发。
- **任务**:
  1.  **定义YAML策略格式**: 设计一个简单的YAML结构来描述QoS策略。例如：
      ```yaml
      policies:
        - name: ensure-course-selection-priority
          match:
            source_ip: "10.1.1.10/32" # 选课系统服务器IP
          action:
            set_priority: "af41" # 高优先级DSCP值
          target_interface: "Ethernet1/1"
      ```
  2.  **开发策略引擎**: 编写`engine.py`，实现读取YAML文件，并根据第一周的成果，将其内容“翻译”成NX-API所需的JSON命令负载。
  3.  **开发配置下发模块**: 封装一个函数，负责发送命令、处理响应和记录成功或失败。

**第三周：服务化与初步展示 (2025/10/13 - 2025/10/19)**
- **目标**: 将核心功能API化，并提供一个简单的监控页面。
- **任务**:
  1.  **开发Flask API**: 创建一个API端点，如`/api/apply-policy`，调用策略引擎执行策略下发。
  2.  **开发数据采集与展示**:
      - 使用`APScheduler`每分钟运行一次采集脚本，获取CPU和接口状态。
      - 创建一个简单的HTML页面，通过JavaScript定时请求后端API，展示获取到的数据。
  3.  **整合与测试**: 将所有模块联调，从修改YAML文件到观察设备配置变化和前端页面更新，完成端到端测试。
  4.  **文档**: 编写`README.md`，说明如何配置、运行和使用该平台。

#### 5. 未来扩展方向

- **集成配置管理工具**: 策略引擎可以被设计为生成Chef/Puppet的配置文件，而不是直接调用API，从而融入更广泛的DevOps流程。
- **支持NETCONF/RESTCONF**: 在配置下发模块中增加新的适配器，以支持不同的南向接口协议。
- **闭环自动化**: 结合更智能的监控分析，当检测到特定应用性能下降时，自动触发QoS策略调整，实现真正的智能运维。
